{% extends 'baseadmin.html' %}

{% block title %}Panel de Administración{% endblock %}

{% block body %}
<!--MENSAJE DE ALERTA SweetAlert2-->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<ul class=flashes>
    {% for category, message in messages %}
    <script type="text/javascript">
        const Toast = Swal.mixin({
            toast: true,
            position: "top-end",
            showConfirmButton: false,
            timer: 2000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.onmouseenter = Swal.stopTimer;
                toast.onmouseleave = Swal.resumeTimer;
            }
        });
        Toast.fire({
            icon: "{{ 'success' if category == 'success' else 'error' }}",
            title: "{{message}}"
        });
    </script>
    {% endfor %}
</ul>
{% endif %}
{% endwith %}

<!-- PERFIL DEL USUARIO ADMINISTRADOR -->
<div class="container p-5 mt-3">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <!-- Card Principal del Perfil -->
            <div class="card shadow-lg border-0 mb-5" style="background: #f8f9fa; border: 1px solid #dee2e6 !important;">
                <!-- Header de la Card -->
                <div class="card-header text-center py-4" style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);">
                    <div class="row align-items-center">
                        <div class="col-md-3 position-relative">
                            <!-- Imagen de perfil editable -->
                            <div class="position-relative d-inline-block">
                                <img id="fotoPerfil"
                                    src="{{ url_for('static', filename=session.get('foto_perfil', 'img/user.png')) }}"
                                    class="img-fluid rounded-circle shadow" alt="Foto de perfil"
                                    style="width: 120px; height: 120px; object-fit: cover; border: 4px solid white;"
                                    data-bs-toggle="tooltip" data-bs-placement="top" 
                                    title="Tu foto de perfil actual">
                                <!-- Botón para cambiar foto -->
                                <button type="button"
                                    class="btn btn-primary btn-sm position-absolute bottom-0 end-0 rounded-circle"
                                    data-bs-toggle="modal" data-bs-target="#modalCambiarFoto"
                                    style="width: 35px; height: 35px; padding: 0; background: #3498db; border: 2px solid white;"
                                    data-bs-toggle="tooltip" data-bs-placement="top" 
                                    title="Cambiar foto de perfil">
                                    <i class="fas fa-camera" style="color: white;"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <h2 class="text-white mb-1" style="font-weight: bold;">{{ session.get('nombre', 'Usuario') }}</h2>
                            <p class="text-light mb-0">
                                {% if session.get('rol') == 1 %}
                                <span class="badge bg-danger" 
                                      data-bs-toggle="tooltip" data-bs-placement="top" 
                                      title="Tienes permisos de administrador">Administrador</span>
                                {% else %}
                                <span class="badge bg-primary"
                                      data-bs-toggle="tooltip" data-bs-placement="top" 
                                      title="Tienes permisos de usuario estándar">Usuario</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Body de la Card -->
                <div class="card-body p-5" style="color: #2c3e50;">
                    <!-- Información del Usuario -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5 class="mb-3" style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                                <i class="fas fa-user"></i> Información Personal
                            </h5>
                            <div class="mb-3">
                                <label class="form-label fw-bold" style="color: #2c3e50;"
                                       data-bs-toggle="tooltip" data-bs-placement="top" 
                                       title="Tu nombre completo">Nombre Completo:</label>
                                <p class="form-control" style="background: #ecf0f1; border: 1px solid #bdc3c7; color: #2c3e50;"
                                   data-bs-toggle="tooltip" data-bs-placement="top" 
                                   title="Nombre registrado: {{ session.get('nombre', 'No disponible') }}">{{ session.get('nombre', 'No disponible') }}</p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold" style="color: #2c3e50;"
                                       data-bs-toggle="tooltip" data-bs-placement="top" 
                                       title="Identificador único en el sistema">ID de Usuario:</label>
                                <p class="form-control" style="background: #ecf0f1; border: 1px solid #bdc3c7; color: #2c3e50;"
                                   data-bs-toggle="tooltip" data-bs-placement="top" 
                                   title="Tu ID de usuario: {{ session.get('id', 'No disponible') }}">{{ session.get('id', 'No disponible') }}</p>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <h5 class="mb-3" style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                                <i class="fas fa-shield-alt"></i> Información de Cuenta
                            </h5>
                            <div class="mb-3">
                                <label class="form-label fw-bold" style="color: #2c3e50;"
                                       data-bs-toggle="tooltip" data-bs-placement="top" 
                                       title="Tu rol en el sistema">Rol:</label>
                                <p class="form-control" style="background: #ecf0f1; border: 1px solid #bdc3c7; color: #2c3e50;"
                                   data-bs-toggle="tooltip" data-bs-placement="top" 
                                   title="{% if session.get('rol') == 1 %}Administrador - Acceso completo al sistema{% else %}Usuario - Acceso limitado{% endif %}">
                                    {% if session.get('rol') == 1 %}
                                    Administrador
                                    {% elif session.get('rol') == 2 %}
                                    Usuario
                                    {% else %}
                                    No definido
                                    {% endif %}
                                </p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold" style="color: #2c3e50;"
                                       data-bs-toggle="tooltip" data-bs-placement="top" 
                                       title="Tu correo electrónico">Email:</label>
                                <p class="form-control" style="background: #ecf0f1; border: 1px solid #bdc3c7; color: #2c3e50;"
                                   data-bs-toggle="tooltip" data-bs-placement="top" 
                                   title="Correo: {{ session.get('email', 'No disponible') }}">{{ session.get('email', 'No disponible') }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Botones de Acción -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <button class="btn btn-warning me-md-2" data-bs-toggle="modal"
                                    data-bs-target="#modalEditarPerfil" style="border: none; font-weight: bold;"
                                    data-bs-toggle="tooltip" data-bs-placement="top" 
                                    title="Editar nombre y correo electrónico">
                                    <i class="fas fa-edit"></i> Editar Perfil
                                </button>
                                <button class="btn btn-danger" data-bs-toggle="modal"
                                    data-bs-target="#modalCambiarPassword" style="border: none; font-weight: bold;"
                                    data-bs-toggle="tooltip" data-bs-placement="top" 
                                    title="Cambiar tu contraseña de acceso">
                                    <i class="fas fa-key"></i> Cambiar Contraseña
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- GESTIÓN DE USUARIOS (Solo visible para administradores) -->
{% if session.get('rol') == 1 %}
<div class="container mb-5">
    <div class="row justify-content-center">
        <div class="col-md-12">
            
            <!-- AGREGAR NUEVO USUARIO (REPLEGABLE) -->
            <div class="card mb-4 shadow-lg" style="border-radius: 10px; background: #f8f9fa; border: 1px solid #dee2e6;">
                <div class="card-header text-white d-flex justify-content-between align-items-center" 
                     style="background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); border-radius: 10px 10px 0 0;">
                    <h5 class="mb-0 text-white" style="font-weight: bold;">Gestión de Usuarios</h5>
                    <button class="btn btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#agregarUsuarioCollapse" 
                            aria-expanded="true" aria-controls="agregarUsuarioCollapse"
                            style="border: 2px solid white; color: white; background: transparent; font-weight: bold;"
                            data-bs-toggle="tooltip" data-bs-placement="top" 
                            title="Mostrar/ocultar formulario para agregar usuario">
                        Agregar Usuario
                    </button>
                </div>
                <div class="collapse show" id="agregarUsuarioCollapse">
                    <div class="card-body" style="background: white;">
                        <form method="POST" id="addUserForm">
                            <input type="hidden" name="agregar_usuario" value="1">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label class="form-label" style="color: #2c3e50;"
                                           data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Nombre completo del nuevo usuario">Nombre</label>
                                    <input type="text" name="nombre" class="form-control" 
                                           style="background: white; border: 1px solid #bdc3c7; color: #2c3e50;" required
                                           data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Ej: Juan Pérez, María García">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label" style="color: #2c3e50;"
                                           data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Correo electrónico único del usuario">Correo</label>
                                    <input type="email" name="email" class="form-control" 
                                           style="background: white; border: 1px solid #bdc3c7; color: #2c3e50;" required
                                           data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Ej: usuario@ejemplo.com">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label" style="color: #2c3e50;"
                                           data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="Contraseña para el nuevo usuario">Contraseña</label>
                                    <input type="text" name="password" class="form-control" 
                                           style="background: white; border: 1px solid #bdc3c7; color: #2c3e50;" required
                                           data-bs-toggle="tooltip" data-bs-placement="top" 
                                           title="La contraseña se encriptará automáticamente">
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success" style="border: none; font-weight: bold;"
                                    data-bs-toggle="tooltip" data-bs-placement="top" 
                                    title="Guardar nuevo usuario en el sistema">
                                Agregar Usuario
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- ENCABEZADO DE LISTA DE USUARIOS -->
            <div class="mb-3">
                <div class="text-center" style="padding: 20px;">
                    <h4 class="mb-0" style="font-size: 1.8rem; font-weight: 600; color: #2c3e50;"
                        data-bs-toggle="tooltip" data-bs-placement="top" 
                        title="Lista completa de usuarios registrados en el sistema">
                        Lista de Usuarios
                    </h4>
                </div>
            </div>

            <!-- LISTA DE USUARIOS -->
            <div class="card mb-4 shadow-lg" style="border-radius: 10px; background: white; border: 1px solid #dee2e6;">
                <div class="card-body" style="background: white;">
                    <table class="table table-hover" style="background: white; color: #2c3e50; border-radius: 8px;">
                        <thead>
                            <tr>
                                <th class="text-white" style="background: #34495e !important;"
                                    data-bs-toggle="tooltip" data-bs-placement="top" 
                                    title="Número de orden">N°</th>
                                <th class="text-white" style="background: #34495e !important;"
                                    data-bs-toggle="tooltip" data-bs-placement="top" 
                                    title="Nombre del usuario">Nombre</th>
                                <th class="text-white" style="background: #34495e !important;"
                                    data-bs-toggle="tooltip" data-bs-placement="top" 
                                    title="Correo electrónico">Correo</th>
                                <th class="text-white" style="background: #34495e !important;"
                                    data-bs-toggle="tooltip" data-bs-placement="top" 
                                    title="Contraseña (encriptada)">Contraseña</th>
                                <th class="text-white" style="background: #34495e !important;"
                                    data-bs-toggle="tooltip" data-bs-placement="top" 
                                    title="Rol del usuario en el sistema">Rol</th>
                                <th class="text-white" style="background: #34495e !important;"
                                    data-bs-toggle="tooltip" data-bs-placement="top" 
                                    title="Acciones disponibles">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for u in usuarios %}
                            <tr style="border-bottom: 1px solid #ecf0f1;">
                                <td style="color: #2c3e50;"
                                    data-bs-toggle="tooltip" data-bs-placement="top" 
                                    title="Usuario número {{ loop.index }}">{{ loop.index }}</td>
                                <td data-bs-toggle="tooltip" data-bs-placement="top" 
                                    title="Nombre: {{ u.nombre }}">{{ u.nombre }}</td>
                                <td data-bs-toggle="tooltip" data-bs-placement="top" 
                                    title="Email: {{ u.email }}">{{ u.email }}</td>
                                <td data-bs-toggle="tooltip" data-bs-placement="top" 
                                    title="Contraseña encriptada">{{ u.password }}</td>
                                <td>
                                    {% if u.id_rol == 1 %}
                                    <span class="badge bg-danger"
                                          data-bs-toggle="tooltip" data-bs-placement="top" 
                                          title="Administrador - Acceso completo">Administrador</span>
                                    {% else %}
                                    <span class="badge bg-primary"
                                          data-bs-toggle="tooltip" data-bs-placement="top" 
                                          title="Usuario - Acceso limitado">Usuario</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-success me-1" data-bs-toggle="collapse" data-bs-target="#editar{{ u.id }}" 
                                            style="border: none; font-weight: bold;"
                                            data-bs-toggle="tooltip" data-bs-placement="top" 
                                            title="Editar información de {{ u.nombre }}">
                                        Editar
                                    </button>
                                    <a href="{{ url_for('listar') }}?eliminar_usuario={{ u.id }}" class="btn btn-sm btn-danger delete-user" 
                                       style="border: none; font-weight: bold;"
                                       data-bs-toggle="tooltip" data-bs-placement="top" 
                                       title="Eliminar usuario {{ u.nombre }}">
                                        Eliminar
                                    </a>
                                </td>
                            </tr>
                            <tr class="collapse" id="editar{{ u.id }}" style="background: #f8f9fa;">
                                <td colspan="6">
                                    <form method="POST" class="update-user-form">
                                        <input type="hidden" name="id" value="{{ u.id }}">
                                        <input type="hidden" name="editar_usuario" value="1">
                                        <div class="row">
                                            <div class="col-md-3 mb-2">
                                                <input type="text" name="nombre" class="form-control" 
                                                       style="background: white; border: 1px solid #bdc3c7; color: #2c3e50;" value="{{ u.nombre }}" required
                                                       data-bs-toggle="tooltip" data-bs-placement="top" 
                                                       title="Nuevo nombre para {{ u.nombre }}">
                                            </div>
                                            <div class="col-md-3 mb-2">
                                                <input type="email" name="email" class="form-control" 
                                                       style="background: white; border: 1px solid #bdc3c7; color: #2c3e50;" value="{{ u.email }}" required
                                                       data-bs-toggle="tooltip" data-bs-placement="top" 
                                                       title="Nuevo correo para {{ u.email }}">
                                            </div>
                                            <div class="col-md-3 mb-2">
                                                <input type="text" name="password" class="form-control" 
                                                       style="background: white; border: 1px solid #bdc3c7; color: #2c3e50;" value="{{ u.password }}" required
                                                       data-bs-toggle="tooltip" data-bs-placement="top" 
                                                       title="Nueva contraseña (se encriptará automáticamente)">
                                            </div>
                                            <div class="col-md-3 mb-2">
                                                <select name="id_rol" class="form-control" style="background: white; border: 1px solid #bdc3c7; color: #2c3e50;"
                                                        data-bs-toggle="tooltip" data-bs-placement="top" 
                                                        title="Seleccionar rol del usuario">
                                                    <option value="1" {% if u.id_rol == 1 %}selected{% endif %}>Administrador</option>
                                                    <option value="2" {% if u.id_rol == 2 %}selected{% endif %}>Usuario</option>
                                                </select>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary btn-sm mt-1 update-user-btn" 
                                                style="border: none; font-weight: bold;"
                                                data-bs-toggle="tooltip" data-bs-placement="top" 
                                                title="Guardar cambios para {{ u.nombre }}">
                                            Actualizar
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- MODALES PARA EL PERFIL -->
<!-- Modal Cambiar Foto de Perfil -->
<div class="modal fade" id="modalCambiarFoto" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="background: white; border: 1px solid #dee2e6;">
            <div class="modal-header" style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);">
                <h5 class="modal-title text-white" style="font-weight: bold;">
                    <i class="fas fa-camera"></i> Cambiar Foto de Perfil
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                        data-bs-toggle="tooltip" data-bs-placement="top" 
                        title="Cerrar ventana"></button>
            </div>
            <form action="{{ url_for('cambiar_foto_perfil') }}" method="POST" enctype="multipart/form-data">
                <div class="modal-body text-center" style="color: #2c3e50;">
                    <!-- Vista previa de la imagen -->
                    <div class="mb-3">
                        <img id="vistaPrevia"
                            src="{{ url_for('static', filename=session.get('foto_perfil', 'img/user.png')) }}"
                            class="img-fluid rounded-circle shadow mb-3" alt="Vista previa"
                            style="width: 150px; height: 150px; object-fit: cover; border: 3px solid #3498db;"
                            data-bs-toggle="tooltip" data-bs-placement="top" 
                            title="Vista previa de tu nueva foto">
                    </div>

                    <!-- Selección de archivo -->
                    <div class="mb-3">
                        <label for="foto" class="form-label fw-bold"
                               data-bs-toggle="tooltip" data-bs-placement="top" 
                               title="Subir imagen desde tu dispositivo">Seleccionar nueva imagen:</label>
                        <input type="file" class="form-control" id="foto" name="foto" accept="image/*" style="background: white; border: 1px solid #bdc3c7; color: #2c3e50;"
                               data-bs-toggle="tooltip" data-bs-placement="top" 
                               title="Formatos: JPG, PNG, GIF - Máximo 2MB">
                        <div class="form-text" style="color: #7f8c8d;">
                            Formatos permitidos: JPG, PNG, GIF. Tamaño máximo: 2MB
                        </div>
                    </div>

                    <!-- Opciones de imagen predefinidas -->
                    <div class="mb-3">
                        <label class="form-label fw-bold"
                               data-bs-toggle="tooltip" data-bs-placement="top" 
                               title="Seleccionar avatar predefinido">O selecciona una imagen predefinida:</label>
                        <div class="row text-center">
                            <div class="col-3">
                                <input type="radio" class="btn-check" name="foto_predefinida" value="img/user.png"
                                    id="foto1" autocomplete="off">
                                <label class="btn btn-outline-primary w-100" for="foto1"
                                       data-bs-toggle="tooltip" data-bs-placement="top" 
                                       title="Avatar predeterminado 1">
                                    <img src="{{ url_for('static', filename='img/user.png') }}"
                                        class="img-fluid rounded" style="width: 50px; height: 50px; object-fit: cover;">
                                </label>
                            </div>
                            <div class="col-3">
                                <input type="radio" class="btn-check" name="foto_predefinida" value="img/user2.png"
                                    id="foto2" autocomplete="off">
                                <label class="btn btn-outline-primary w-100" for="foto2"
                                       data-bs-toggle="tooltip" data-bs-placement="top" 
                                       title="Avatar predeterminado 2">
                                    <img src="{{ url_for('static', filename='img/user2.png') }}"
                                        class="img-fluid rounded" style="width: 50px; height: 50px; object-fit: cover;">
                                </label>
                            </div>
                            <div class="col-3">
                                <input type="radio" class="btn-check" name="foto_predefinida" value="img/user3.png"
                                    id="foto3" autocomplete="off">
                                <label class="btn btn-outline-primary w-100" for="foto3"
                                       data-bs-toggle="tooltip" data-bs-placement="top" 
                                       title="Avatar predeterminado 3">
                                    <img src="{{ url_for('static', filename='img/user3.png') }}"
                                        class="img-fluid rounded" style="width: 50px; height: 50px; object-fit: cover;">
                                </label>
                            </div>
                            <div class="col-3">
                                <input type="radio" class="btn-check" name="foto_predefinida" value="img/user4.png"
                                    id="foto4" autocomplete="off">
                                <label class="btn btn-outline-primary w-100" for="foto4"
                                       data-bs-toggle="tooltip" data-bs-placement="top" 
                                       title="Avatar predeterminado 4">
                                    <img src="{{ url_for('static', filename='img/user4.png') }}"
                                        class="img-fluid rounded" style="width: 50px; height: 50px; object-fit: cover;">
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #dee2e6;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                            data-bs-toggle="tooltip" data-bs-placement="top" 
                            title="Cancelar y cerrar">Cancelar</button>
                    <button type="submit" class="btn btn-primary"
                            data-bs-toggle="tooltip" data-bs-placement="top" 
                            title="Guardar nueva foto de perfil">Cambiar Foto</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal Editar Perfil -->
<div class="modal fade" id="modalEditarPerfil" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="background: white; border: 1px solid #dee2e6;">
            <div class="modal-header" style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);">
                <h5 class="modal-title text-white" style="font-weight: bold;">
                    <i class="fas fa-edit"></i> Editar Perfil
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                        data-bs-toggle="tooltip" data-bs-placement="top" 
                        title="Cerrar ventana"></button>
            </div>
            <form action="{{ url_for('actualizar_perfil') }}" method="POST">
                <div class="modal-body" style="color: #2c3e50;">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" name="nombre"
                            value="{{ session.get('nombre', '') }}" required style="background: white; border: 1px solid #bdc3c7; color: #2c3e50;"
                            data-bs-toggle="tooltip" data-bs-placement="top" 
                            title="Tu nombre completo">
                        <label style="color: #7f8c8d;">Nombre Completo</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="email" class="form-control" name="email" value="{{ session.get('email', '') }}"
                            required style="background: white; border: 1px solid #bdc3c7; color: #2c3e50;"
                            data-bs-toggle="tooltip" data-bs-placement="top" 
                            title="Tu correo electrónico">
                        <label style="color: #7f8c8d;">Correo Electrónico</label>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #dee2e6;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                            data-bs-toggle="tooltip" data-bs-placement="top" 
                            title="Cancelar cambios">Cancelar</button>
                    <button type="submit" class="btn btn-primary"
                            data-bs-toggle="tooltip" data-bs-placement="top" 
                            title="Guardar cambios del perfil">Actualizar Perfil</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal Cambiar Contraseña -->
<div class="modal fade" id="modalCambiarPassword" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="background: white; border: 1px solid #dee2e6;">
            <div class="modal-header" style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);">
                <h5 class="modal-title text-white" style="font-weight: bold;">
                    <i class="fas fa-key"></i> Cambiar Contraseña
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                        data-bs-toggle="tooltip" data-bs-placement="top" 
                        title="Cerrar ventana"></button>
            </div>
            <form action="{{ url_for('cambiar_password') }}" method="POST">
                <div class="modal-body" style="color: #2c3e50;">
                    <div class="form-floating mb-3">
                        <input type="password" class="form-control" name="password_actual"
                            placeholder="Contraseña actual" required style="background: white; border: 1px solid #bdc3c7; color: #2c3e50;"
                            data-bs-toggle="tooltip" data-bs-placement="top" 
                            title="Tu contraseña actual">
                        <label style="color: #7f8c8d;">Contraseña Actual</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="password" class="form-control" name="nueva_password" placeholder="Nueva contraseña"
                            required style="background: white; border: 1px solid #bdc3c7; color: #2c3e50;"
                            data-bs-toggle="tooltip" data-bs-placement="top" 
                            title="Nueva contraseña deseada">
                        <label style="color: #7f8c8d;">Nueva Contraseña</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="password" class="form-control" name="confirmar_password"
                            placeholder="Confirmar contraseña" required style="background: white; border: 1px solid #bdc3c7; color: #2c3e50;"
                            data-bs-toggle="tooltip" data-bs-placement="top" 
                            title="Repite la nueva contraseña">
                        <label style="color: #7f8c8d;">Confirmar Nueva Contraseña</label>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #dee2e6;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                            data-bs-toggle="tooltip" data-bs-placement="top" 
                            title="Cancelar cambio">Cancelar</button>
                    <button type="submit" class="btn btn-primary"
                            data-bs-toggle="tooltip" data-bs-placement="top" 
                            title="Actualizar contraseña">Cambiar Contraseña</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Scripts -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Inicializar tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        const inputFoto = document.getElementById('foto');
        const vistaPrevia = document.getElementById('vistaPrevia');

        // Vista previa cuando se selecciona un archivo
        if (inputFoto) {
            inputFoto.addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        vistaPrevia.src = e.target.result;
                        // Deseleccionar fotos predefinidas
                        document.querySelectorAll('input[name="foto_predefinida"]').forEach(radio => {
                            radio.checked = false;
                        });
                    }
                    reader.readAsDataURL(file);
                }
            });
        }

        // Cambiar vista previa cuando se selecciona foto predefinida
        document.querySelectorAll('input[name="foto_predefinida"]').forEach(radio => {
            radio.addEventListener('change', function () {
                if (this.checked) {
                    vistaPrevia.src = "{{ url_for('static', filename='') }}" + this.value;
                    if (inputFoto) inputFoto.value = ''; // Limpiar input file
                }
            });
        });

        // SweetAlert2 para eliminar usuarios
        const deleteButtons = document.querySelectorAll('.delete-user');
        deleteButtons.forEach(btn => {
            btn.addEventListener('click', function (e) {
                e.preventDefault();
                const url = this.href;

                Swal.fire({
                    title: '¿Deseas eliminar este usuario?',
                    text: "Esta acción no se puede deshacer",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Sí, eliminar',
                    cancelButtonText: 'Cancelar'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = url;
                    }
                });
            });
        });

        // SweetAlert2 para actualizar usuarios
        const updateForms = document.querySelectorAll('.update-user-form');
        updateForms.forEach(form => {
            form.addEventListener('submit', function (e) {
                e.preventDefault();
                Swal.fire({
                    title: '¿Deseas actualizar este usuario?',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Sí, actualizar',
                    cancelButtonText: 'Cancelar'
                }).then((result) => {
                    if (result.isConfirmed) {
                        form.submit();
                    }
                });
            });
        });

        // SweetAlert2 para agregar usuarios
        const addUserForm = document.querySelector('#addUserForm');
        if(addUserForm) {
            addUserForm.addEventListener('submit', function(e) {
                e.preventDefault();
                Swal.fire({
                    title: '¿Deseas agregar este usuario?',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#28a745',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Sí, agregar',
                    cancelButtonText: 'Cancelar'
                }).then((result) => {
                    if(result.isConfirmed){
                        addUserForm.submit();
                    }
                });
            });
        }
    });
</script>

<style>
    body {
        background: #f8f9fa !important;
        color: #2c3e50;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .card {
        border-radius: 10px;
        overflow: hidden;
    }

    .card-header {
        border-bottom: none;
    }

    .btn-check:checked+.btn-outline-primary {
        background-color: #3498db;
        border-color: #3498db;
        color: white;
    }

    .position-relative .btn {
        transform: translate(25%, 25%);
    }

    .form-control[readonly] {
        background-color: #ecf0f1;
        border: 1px solid #bdc3c7;
        color: #2c3e50;
    }

    thead th {
        background: #34495e !important;
        color: white !important;
        border-radius: 5px;
    }

    /* Efectos hover suaves */
    .btn:hover {
        transform: translateY(-1px);
        transition: all 0.2s ease;
    }

    /* Estilos para los badges */
    .badge {
        font-weight: bold;
        padding: 6px 10px;
        border-radius: 15px;
    }

    /* Estilos para tooltips personalizados */
    .tooltip {
        font-size: 0.85rem;
    }

    .tooltip-inner {
        background-color: #2c3e50;
        padding: 8px 12px;
        border-radius: 6px;
        max-width: 300px;
    }

    .tooltip.bs-tooltip-top .tooltip-arrow::before {
        border-top-color: #2c3e50;
    }

    .tooltip.bs-tooltip-bottom .tooltip-arrow::before {
        border-bottom-color: #2c3e50;
    }

    .tooltip.bs-tooltip-start .tooltip-arrow::before {
        border-left-color: #2c3e50;
    }

    .tooltip.bs-tooltip-end .tooltip-arrow::before {
        border-right-color: #2c3e50;
    }

    /* Cursor help para elementos con tooltip */
    [data-bs-toggle="tooltip"] {
        cursor: help;
    }
</style>
{% endblock %}